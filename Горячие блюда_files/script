IframeWidgetFunctional = { body: null, buttonOpen: null, buttonClose: null, popupBlock: null, contentBlock: null, innerBlock: null, iframe: null, iframeAdded: false, initDone: false, specialPartnerParams: null, selectorClose: null, selectorInner: null, selectorWidget: null, selectorPopupBlock: null, nameIframe: null, cssText: '.___iframe_widget { opacity: 0; overflow: hidden;}.___iframe_widget.active { opacity: 1; overflow-x: hidden; overflow-y: auto;}.___iframe_widget__overlay { position: fixed; bottom: 0px; left: 0px; right: 0px; top: 0px; z-index: 10001; background-color: #000; opacity: 0.5;}.___iframe_widget__modal { position: fixed; bottom: 0px; left: 0px; right: 0px; top: 0px; z-index: 10002; overflow-x: hidden; overflow-y: auto;}.___iframe_widget__content { position: relative; width: 900px; height: 650px; margin-left: auto; margin-right: auto; /*margin-top: 40px;*/ /*margin-bottom: 40px;*/ background-color: #ffffff;}.___iframe_widget__close { line-height: 1; box-sizing: content-box; cursor: pointer; position: absolute; z-index: 10003; left: auto; right: 0; margin-top: 0; margin-right: -36px; width: 14px; height: 14px; padding: 10px; border-radius: 5px; background-color: rgba(86, 86, 86, 0.75); text-align: center; vertical-align: middle; transition: background-color 0.4s;}.___iframe_widget__close:hover { background-color: rgba(86, 86, 86, 1);}.___iframe_widget__close svg { width: 14px; height: 14px;}.___iframe_widget__inner { position: relative; width: 100%; height: 100%; overflow: hidden; -webkit-overflow-scrolling: touch;}.___iframe_widget__iframe { width: 100%; height: 100%; border: none;}.___iframe_widget_body { overflow: hidden;}.___iframe_widget__inner .confirm-close-iframe { font-family: "Gotham Pro", "GothamPro", sans-serif; position: absolute; top: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,.92); display: flex; -webkit-box-orient: vertical; -webkit-box-direction: normal; flex-direction: column; -webkit-box-align: center; align-items: center; -webkit-box-pack: center; justify-content: center;}.___iframe_widget__inner .reject-text-iframe { font-size: 18px; line-height: 25px; margin-bottom: 24px; letter-spacing: .6px; opacity: .8;}.___iframe_widget__inner .reject-buttons-iframe { display: -webkit-box; display: -ms-flexbox; display: flex; -webkit-box-pack: center; -ms-flex-pack: center; justify-content: center;}.___iframe_widget__inner .reject__button--no-iframe { font-family: "Gotham Pro", "GothamPro", sans-serif; font-size: 16px; font-weight: 400; line-height: 28px; min-width: 182px; margin-right: 12px; margin-left: 12px; padding: 10px 16px; cursor: pointer; -webkit-transition: all .4s; transition: all .4s; text-align: center; text-decoration: none; letter-spacing: .5px; border: none; border-radius: 6px; background-color:#72bf44; -webkit-box-align: center; -ms-flex-align: center; align-items: center; -webkit-box-pack: justify; -ms-flex-pack: justify; justify-content: space-between; color: #fff;}.___iframe_widget__inner .reject__button--yes-iframe { font-family: "Gotham Pro", "GothamPro", sans-serif; font-weight: 400; font-size: 16px; line-height: 28px; min-width: 182px; margin-right: 12px; margin-left: 12px; padding: 10px 16px; cursor: pointer; -webkit-transition: all .4s; transition: all .4s; text-align: center; text-decoration: none; letter-spacing: .5px; color: #1e1e1e; border: none; border-radius: 6px; -webkit-box-align: center; -ms-flex-align: center; align-items: center; -webkit-box-pack: justify; -ms-flex-pack: justify; justify-content: space-between; background-color: #eee;}.___iframe_widget__content{ width:900px; height:650px; }', iframeHeight: '650', iframeWidth: '900', screenWidthForRedirect: '1024', urlIframe: 'https://cafe-anderson.digift.ru/w', urlLanding: 'https://cafe-anderson.digift.ru/', urlIframeCheckBalance: 'https://cafe-anderson.digift.ru/wcb', urlLandingCheckBalance: 'https://cafe-anderson.digift.ru/cb', urlRememberSpecParams: 'https://cafe-anderson.digift.ru/partner/index/rememberSpecParams', partnerColor: '#7cbd41', closeSvg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" height="14px" width="14px" fill="#ffffff"> <polygon points="14,1.556 12.444,0 7,5.445 1.555,0 0,1.556 5.444,7 0,12.445 1.555,14 7,8.556 12.444,14 14,12.445 8.555,7"/></svg>', modeDefault: 'default', modeBalance: 'balance', mark: null, actionUrl: null, addSpecParams: function (params) { if (typeof params === 'object') { this.specialPartnerParams = params; } }, initMark: function () { var uuidv4 = function() { return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) { var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8); return v.toString(16); }); }; this.mark = uuidv4(); }, init: function (selectors, checkBalanceSelectors) { /* https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/remove */ (function (arr) { arr.forEach(function (item) { if (item.hasOwnProperty('remove')) { return; } Object.defineProperty(item, 'remove', { configurable: true, enumerable: true, writable: true, value: function remove() { if (this.parentNode === null) { return; } this.parentNode.removeChild(this); } }); }); })([Element.prototype, CharacterData.prototype, DocumentType.prototype]); if ( this.initDone === false ) { this.initMark(); this.actionUrl = this.urlLanding; this.selectorClose = '__jsc_widget_close_' + this.mark; this.selectorInner = '__jsc_widget_inner_' + this.mark; this.selectorWidget = '__jsc_widget_iframe_' + this.mark; this.selectorPopupBlock = '__jsc_widget_' + this.mark; this.nameIframe = 'iframeWidgetN_' + this.mark; this.setCss(); this.setBlocks(); this.initCloseEvent(); this.initDone = true; } this.setEvents(selectors, checkBalanceSelectors); }, openPopup: function (mode) { if (typeof mode === 'undefined') { mode = this.modeDefault; } var self = this; var openPopup = function () { /* vertical alignment, if possible */ var mtop = (window.innerHeight - self.iframeHeight) / 2; if (mtop > 0) { self.contentBlock.style = 'margin-top: ' + mtop + 'px;' + 'margin-bottom: ' + mtop + 'px;'; } self.popupBlock.style.display = 'block'; setTimeout(function () { self.clAddClass(self.body,'___iframe_widget_body'); self.clAddClass(self.popupBlock,'active'); }, 30); if (self.iframeAdded == false) { self.innerBlock.appendChild(self.iframe); self.iframeAdded = true; } }; var openNewWindow = function () { self.openNewWindow(); return false; }; var part_url = self.prepareSpecialPartnerParams(); /* redirect to landing */ if (self.needNewWindowInsteadPopup()) { self.actionUrl = ( mode === self.modeBalance ) ? self.urlLandingCheckBalance : self.urlLanding; if ( part_url ) { self.actionUrl = self.actionUrl + '?k=' + part_url; } console.log(mode, self.actionUrl); openNewWindow(); } else { self.actionUrl = ( mode === self.modeBalance ) ? self.urlIframeCheckBalance : self.urlIframe; if ( part_url ) { self.actionUrl = self.actionUrl + '?k=' + part_url; } self.iframe.src = self.actionUrl; openPopup(); } }, /* private method */ closePopup: function () { var self = this; self.clRemoveClass(self.body,'___iframe_widget_body'); self.clRemoveClass(self.popupBlock,'active'); setTimeout(function () { self.popupBlock.style.display = 'none'; }, 500); }, /* private method */ setCss: function () { var style = document.createElement('style'); style.setAttribute('type', 'text/css'); if ( style.styleSheet ) { style.styleSheet.cssText = this.cssText; } else { style.appendChild(document.createTextNode(this.cssText)); } var head = document.head || document.getElementsByTagName('head')[0]; head.appendChild(style); }, /* private method */ setBlocks: function () { this.body = document.body || document.getElementsByTagName('body')[0]; this.iframe = document.createElement('iframe'); this.iframe.setAttribute('src', this.urlIframe); this.iframe.setAttribute('name', this.nameIframe); this.iframe.setAttribute('scrolling', 'no'); this.iframe.className = '___iframe_widget__iframe ' + this.selectorWidget; this.innerBlock = document.createElement('div'); this.innerBlock.className = '___iframe_widget__inner ' + this.selectorInner; this.buttonClose = document.createElement('div'); this.buttonClose.className = '___iframe_widget__close ' + this.selectorClose; this.buttonClose.innerHTML = this.closeSvg; this.popupBlock = document.createElement('div'); this.popupBlock.className = '___iframe_widget ' + this.selectorPopupBlock; this.popupBlock.style.display = 'none'; this.contentBlock = document.createElement('div'); this.contentBlock.className = '___iframe_widget__content'; this.contentBlock.appendChild(this.buttonClose); this.contentBlock.appendChild(this.innerBlock); var overlay = document.createElement('div'); overlay.className = '___iframe_widget__overlay'; var modal = document.createElement('div'); modal.className = '___iframe_widget__modal'; modal.appendChild(this.contentBlock); this.popupBlock.appendChild(overlay); this.popupBlock.appendChild(modal); this.body.appendChild(this.popupBlock); }, /* @todo need refactoring */ initCloseEvent: function () { var self = this; this.buttonClose.addEventListener("click", function () { var c1 = 'c1_' + self.mark; var c2 = 'c2_' + self.mark; var c3 = 'c3_' + self.mark; var c4 = 'c4_' + self.mark; var c5 = 'c5_' + self.mark; var template = document.createElement('div'); template.innerHTML = '<div class="confirm-close-iframe '+ c1 +'">\n' + ' <p class="reject-text-iframe '+ c2 +'">\u0412\u044b\u0020\u0443\u0432\u0435\u0440\u0435\u043d\u044b\u002c\u0020\u0447\u0442\u043e\u0020\u0445\u043e\u0442\u0438\u0442\u0435<br> \u043f\u0440\u0435\u0440\u0432\u0430\u0442\u044c\u0020\u043f\u043e\u043a\u0443\u043f\u043a\u0443\u003f</p>\n' + ' <div class="reject-buttons-iframe '+ c3 +'">\n' + ' <button class="reject__button--no-iframe '+ c4 +'" type="button">\u041d\u0435\u0442\u002c\u0020\u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c</button>\n' + ' <button class="reject__button--yes-iframe '+ c5 +'" type="button">\u0414\u0430\u002c\u0020\u043f\u0440\u0435\u0440\u0432\u0430\u0442\u044c</button>\n' + ' </div>\n' + '</div>'.trim(); var iframe = document.getElementsByClassName(self.selectorInner)[0]; elementDOMcloseIframe = document.getElementsByClassName('confirm-close-iframe'); if (elementDOMcloseIframe[0] === undefined) { iframe.appendChild(template); } var confirmBlock = document.getElementsByClassName(c1)[0]; var rejectText = document.getElementsByClassName(c2)[0]; var rejectButtons = document.getElementsByClassName(c3)[0]; var rejectButtonNo = document.getElementsByClassName(c4)[0]; var rejectButtonYes = document.getElementsByClassName(c5)[0]; rejectButtonYes.addEventListener("click", function (e) { template.remove(); self.closePopup(); }, false); rejectButtonNo.addEventListener("click", function (e) { template.remove(); }, false); rejectButtonNo.style.cssText = "background-color: " + self.partnerColor + ";"; }); }, /* private method */ setEvents: function (selectors, checkBalanceSelectors) { var self = this, btnOpen = document.querySelectorAll(selectors), btnCheckBalance = document.querySelectorAll(checkBalanceSelectors); if ( btnOpen.length ) { for ( var i = 0; i < btnOpen.length; i++ ) { btnOpen[i].addEventListener("click", function () { self.openPopup(self.modeDefault); }); } } else { console.log("can't find element by selector (element button for open popup by click), abort."); } if ( btnCheckBalance.length ) { for ( var i = 0; i < btnCheckBalance.length; i++ ) { btnCheckBalance[i].addEventListener("click", function () { self.openPopup(self.modeBalance); }); } } }, openNewWindow: function () { var win = window.open(this.actionUrl, '_blank'); win.focus(); }, needNewWindowInsteadPopup: function () { /* from http://detectmobilebrowsers.com */ var agent = navigator.userAgent || navigator.vendor || window.opera; /* mobile device detected */ if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(agent) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(agent.substr(0, 4)) ) { return true; } /* for tablet check width of screen */ if (window.innerWidth < this.screenWidthForRedirect) { return true; } }, prepareSpecialPartnerParams: function () { /* nothing to prepare */ if (this.specialPartnerParams === null) { return null; } try { return encodeURI(JSON.stringify(this.specialPartnerParams)); } catch (e) { console.log(e); return null; } }, clHasClass: function (el, cl) { let attr = el.getAttribute('class'); if ( attr === null ) { el.className = ''; } return ( attr ) ? (attr.indexOf(cl) > -1) : false; }, /* in ie 11 element.classList not working, alternative */ clAddClass: function (el, cl) { if ( this.clHasClass(el, cl) === false ) { el.setAttribute('class', el.getAttribute('class') + ' ' + cl); } }, /* in ie 11 element.classList not working, alternative *//* */ clRemoveClass: function (el, cl) { if ( this.clHasClass(el, cl) ) { el.setAttribute('class', el.getAttribute('class').replace(cl, ' ')); } },};